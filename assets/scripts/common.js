// Generated by CoffeeScript 1.7.1
(function() {
  var getSessionId, setSessionId, singleValue;

  if (window.goule == null) {
    window.goule = {};
  }

  getSessionId = function() {
    var match;
    match = /goule_id=(.*)/.exec(document.cookie);
    if (match != null) {
      return match[1];
    }
    return '';
  };

  setSessionId = function(id) {
    return document.cookie = 'goule_id=' + id;
  };

  singleValue = function(name, args, cb) {
    return window.goule.api(name, args, function(err, x) {
      if (err != null) {
        return cb(err, null);
      }
      return cb(null, x[0]);
    });
  };

  window.goule.api = function(name, args, cb) {
    var argsStrs, authStr, x;
    argsStrs = (function() {
      var _i, _len, _results;
      _results = [];
      for (_i = 0, _len = args.length; _i < _len; _i++) {
        x = args[_i];
        _results.push(JSON.stringify(x));
      }
      return _results;
    })();
    authStr = name === 'Auth' ? '' : '?id=' + getSessionId();
    $.ajax("/api/" + name + authStr, {
      type: 'POST',
      data: JSON.stringify(argsStrs),
      contentType: 'application/json',
      cache: false,
      dataType: 'json',
      error: function() {
        return cb('Error making API call.', null);
      },
      success: function(data) {
        return cb(null, data);
      }
    });
  };

  window.goule.auth = function(password, cb) {
    return singleValue('Auth', [password], function(err, id) {
      if (err != null) {
        return cb(err, null);
      }
      if (id === '') {
        return cb(null, false);
      }
      setSessionId(id);
      return cb(null, true);
    });
  };

  window.goule.config = function(cb) {
    return singleValue('Config', [], cb);
  };

}).call(this);
